<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TheMusicProject - Buscar</title>
    <link rel="icon" type="image/x-icon" href="photos/icon.ico">
    <link rel="stylesheet" href="index-style.css">
</head>

<body>
    <aside id="aside">
        <div class="sidebar-wrapper">
            <div class="sidebar-logo">
                <img src="photos/THEmusicPROJECT.png" alt="logo">
            </div>
            <div class="sidebar-menu">
                <a href=" ">
                    <i class="fa-solid fa-house"></i> Home
                </a>
                <a class="sidebar-menu-selected" href="index.html">
                    <i class="fa-solid fa-magnifying-glass "></i> Buscar
                </a>
                <a href=" ">
                    <i class="fas fa-database"></i> Biblioteca
                </a>
            </div>
            <div class="sidebar-menu">
                <div class="sidebar-menu-item">
                    <div class="sidebar-menu-item-component ">
                        +
                    </div>
                    <span>Criar Playlist</span>
                </div>
                <div class="sidebar-playlists">
                    <a href=" "> Playlist 1</a>
                    <a href=" "> Playlist 2</a>
                    <a href=" "> Playlist 3</a>
                    <a href=" "> Playlist 4</a>
                    <a href=" "> Playlist 5</a>
                </div>
            </div>
        </div>
    </aside>
    <main id="main">
        <div class="main-wrapper">
            <div id="top">
                <div id="bar_button">
                    <div id="searching-bar">
                        <img src="photos/magnifying_glass.png" alt="magnifying glass" id="magnifying-glass">
                        <input type="text" placeholder="Digite aqui para pesquisar " id="inputBox">
                    </div>
                    <button id="search">Search</button>
                </div>
                <a id="profile">
                    <i class="fa-solid fa-user"></i> Username
                </a>
            </div>
            <div id="results">
                <div class="song">
                    <div class="items-song" id="s-image">
                        <img src="${image}" alt=" " class="image">
                    </div>
                    <div class="items-song" id="s-data">
                        <h1>Lose Yourself</h1>
                        <h2>Eminem</h2>
                        <h2>Album</h2>
                    </div>
                    <div class="items-song">
                        <button style="font-size: 28px;"> + </button>
                        <button style="font-size: 20px;"> 
                            <i class="fa-solid fa-play" style="color: #fff; margin-inline: 16px"></i>
                        </button>
                    </div>
                    <a href="${preview}"></a>
                </div>
            </div>
        </div>
    </main>
    <div class="player">
        <div class="player-artist"></div>
        <div class="player-control">
            <div class="player-control-buttons">
                <a href=" ">
                    <i class="fas fa-backward" style="color: #fff; font-size: 30px; margin-inline: 20px"></i>
                </a>
                <a style="display: none; " id="pauseBtn" href="# " style="color: #fff;">
                    <i class="fa-solid fa-pause" style="color: #fff; font-size: 30px; margin-inline: 20px"></i>
                </a>
                <a id="playBtn" href="#" style="color: #fff; font-size: 30px; display: inline-block;">
                    <i class="fa-solid fa-play" style="color: #fff; margin-inline: 20px"></i>
                </a>
                <a href=" ">
                    <i class="fas fa-forward" style="color: #fff; font-size: 30px; margin-inline: 20px"></i>
                </a>
            </div>
            <div class="player-control-progress">
                <div style="width: 10%;" class="player-control-progress-2"></div>
            </div>
        </div>
    </div>
    <audio id="audioplayer" style="position: absolute; left: 0; top: 0; z-index: -999; opacity: 0;" controls=" "></audio>

    <script src="all.min.js "></script>

    <script>
        function carregarMenu() {
            document.querySelector('#menu').style.marginTop = '0vh';
        }

        function voltar() {
            document.querySelector('#menu').style.marginTop = '-50vh';
        }

        document.querySelector('#irparamenu').onclick = carregarMenu();
        document.querySelector('#voltar').onclick = voltar();

        let buscarBtn = document.querySelector("#search");
        let inpBx = document.querySelector("#inputBox");
        let results = document.querySelector("#results");

        const baseUrl = 'http://localhost:3000/';

        buscarBtn.addEventListener('click', buscar);

        inpBx.addEventListener('keyup', function(e) {
            e.preventDefault();
            let tecla = e.keyCode;
            if (tecla === 13)
                buscarBtn.click();
        })

        function buscar(e) {
            results.innerHTML = 'Buscando...';
            setTimeout(getInfo, 2000);

            e.preventDefault();
            postInfo();
            getInfo();

            async function postInfo(e) // async --> funciona ao mesmo tempo (assincrono)
            {
                if (inpBx.value == " ") {
                    return
                }
                const res = await fetch(baseUrl, // espera executar a função para poder continuar
                    {
                        method: 'POST',
                        headers: {
                            "Content-Type ": 'application/json'
                        },
                        body: JSON.stringify({
                            parcel: inpBx.value
                        })
                    });
            }

            async function getInfo(e) {
                const res = await fetch(baseUrl + 'info/test?key=busca', {
                    method: 'GET'
                });

                console.log(res);
                const data = await res.json();

                let resultado = data.info;

                if (resultado.length == 0)
                    results.innerHTML = "Sem resultados para a busca "
                else
                    results.innerHTML = 'Resultados da Busca';


                for (let pos = 0; pos < resultado.length; pos++) {
                    let title = resultado[pos]["title_short "];
                    let artist = resultado[pos]["artist "];
                    let album = resultado[pos]["album "];
                    let image = resultado[pos]["image "];
                    let preview = resultado[pos]["preview "];

                    results.innerHTML += `
                    <div class="song ">
                        <div class="items-song " id="s-image ">
                            <img src="${image} " alt=" " class="image ">
                        </div>
                        <div class="items-song " id="s-data ">
                            <h1>${title}</h1>
                            <h2>${artist}</h2>
                            <h2>${album}</h2>
                        </div>
                        <div class="items-song ">
                            <a href="${preview} ">
                            </a>
                        </div>
                    </div>
                    `;
                }
            }
        }

        // var audioplayer = document.getElementById('audioplayer');
        // var loaded = false;

        // var playBtn = document.getElementById('playBtn');
        // var pauseBtn = document.getElementById('pauseBtn');

        // playBtn.addEventListener('click', (e) => {
        //     e.preventDefault();

        //     playBtn.style.display = "none ";
        //     pauseBtn.style.display = "inline ";

        // });


        // pauseBtn.addEventListener('click', (e) => {
        //     e.preventDefault();

        //     playBtn.style.display = "inline-block ";
        //     pauseBtn.style.display = "none ";
        //     audioplayer.pause();

        // });

        // playSong = (file) => {

        //     if (loaded == false) {
        //         audioplayer.innerHTML = `<source src="` + file + ` " type="audio/mp3 " />`;
        //         loaded = true;
        //     }

        //     audioPlayer.play();

        //     playBtn.style.display = "none ";
        //     pauseBtn.style.display = "inline-block ";

        // }

        // document.querySelectorAll('.main-col').forEach(item => {

        //     item.addEventListener('click', event => {

        //         let image = item.getAttribute('data-image');
        //         let artist = item.getAttribute('data-artist');
        //         let song = item.getAttribute('data-song');
        //         let file = item.getAttribute('data-file');

        //         let playerArtistComponent = document.getElementsByClassName("player-artist ");

        //         playerArtistComponent[0].innerHTML = `

        //                 <img src="` + image + ` "/>
        //                 <h3>` + song + `<br><span>` + artist + `</span></h3>

        //                 `;

        //         playSong(file)
        //     });

        // })
    </script>
</body>

</html>